# Документация по Markdown форматированию

## Обзор

Telegram Document Bot теперь полностью поддерживает Markdown разметку при генерации документов Word и PDF. Gemini AI автоматически генерирует структурированный контент с правильной разметкой, а DocumentService корректно её обрабатывает и применяет к документам.

## Поддерживаемые элементы Markdown

### 1. Заголовки

Markdown разметка для заголовков с использованием символа `#`:

```markdown
# Заголовок 1 уровня
## Заголовок 2 уровня
### Заголовок 3 уровня
#### Заголовок 4 уровня
##### Заголовок 5 уровня
###### Заголовок 6 уровня
```

**В Word документе:**
- Преобразуются в стили Heading 2-7 (уровень +1)
- Заголовки 1 уровня (#) выравниваются по центру
- Используют встроенные стили Word для заголовков

**В PDF документе:**
- Используют жирный шрифт Times-Bold
- Размер 14pt
- Дополнительные отступы сверху и снизу

### 2. Жирный текст

Две звездочки или двойное подчеркивание:

```markdown
**жирный текст**
__также жирный текст__
```

**В документах:**
- Times New Roman, 12pt, bold
- Применяется к выделенному фрагменту текста

### 3. Курсив

Одна звездочка или одиночное подчеркивание:

```markdown
*текст курсивом*
_также курсивом_
```

**В документах:**
- Times New Roman, 12pt, italic
- Применяется к выделенному фрагменту текста

### 4. Моноширинный текст (код)

Обратные кавычки для инлайн кода:

```markdown
Используйте команду `python app.py` для запуска
```

**В Word документе:**
- Courier New, 11pt
- Обычное начертание

**В PDF документе:**
- Courier шрифт
- Сохраняет читаемость кода

### 5. Маркированные списки

Символы `*`, `-` или `•` в начале строки:

```markdown
* Первый пункт списка
* Второй пункт списка
* Третий пункт списка
```

или

```markdown
- Первый пункт
- Второй пункт
- Третий пункт
```

**В Word документе:**
- Используется стиль "List Bullet"
- Автоматически добавляется маркер •
- Поддерживает форматирование внутри пунктов

**В PDF документе:**
- Маркер • перед каждым пунктом
- Отступ слева 20pt
- Межстрочный интервал 14pt

### 6. Нумерованные списки

Числа с точкой в начале строки:

```markdown
1. Первый шаг
2. Второй шаг
3. Третий шаг
```

**В Word документе:**
- Используется стиль "List Number"
- Автоматическая нумерация
- Поддерживает форматирование внутри пунктов

**В PDF документе:**
- Маркер • (временно, как для маркированных списков)
- Отступ слева 20pt

## Примеры использования

### Пример 1: Структурированный документ

```markdown
## Введение

Это **вводная часть** документа с *важной информацией*.

## Основные положения

### Раздел 1

Текст первого раздела с **ключевыми моментами**.

### Раздел 2

Список требований:

* Первое требование
* Второе требование
* Третье требование

## Заключение

Завершающая часть документа.
```

### Пример 2: Резюме

```markdown
## Иванов Иван Иванович

**Python разработчик**

### Опыт работы

**ООО "Компания", Старший разработчик** (2020 - настоящее время)

Основные обязанности:

* Разработка backend на Python/Django
* Проектирование архитектуры приложений
* Code review и менторство

### Навыки

* Python, Django, FastAPI
* PostgreSQL, Redis
* Docker, Kubernetes
* Git, CI/CD
```

### Пример 3: Договор

```markdown
## ДОГОВОР ОКАЗАНИЯ УСЛУГ

### 1. Предмет договора

**Исполнитель** обязуется оказать следующие услуги:

1. Разработка веб-приложения
2. Тестирование и отладка
3. Развертывание на сервере

### 2. Стоимость и порядок оплаты

Стоимость услуг составляет **100 000 рублей**.

Оплата производится:

* 50% - предоплата
* 50% - после завершения работ
```

## Технические детали реализации

### DocumentService

Класс `DocumentService` содержит следующие методы для обработки Markdown:

#### `_parse_markdown_line(line: str) -> Tuple[str, str, int]`

Определяет тип элемента в строке:
- `'heading'` - заголовок с указанием уровня
- `'list'` - элемент маркированного списка
- `'numbered_list'` - элемент нумерованного списка
- `'text'` - обычный текст

#### `_apply_markdown_formatting(paragraph, text: str)`

Применяет инлайн-форматирование (жирный, курсив, код) к параграфу Word документа.

#### `_process_content_lines(doc: Document, content: str)`

Обрабатывает весь контент построчно, применяя соответствующее форматирование.

#### `_add_list_to_doc(doc: Document, items: List[str], list_type: str)`

Добавляет список в документ с правильным форматированием.

#### `_convert_markdown_to_html(text: str) -> str`

Конвертирует Markdown в HTML для использования в PDF (ReportLab).

### GeminiService

Все промпты в `_create_prompt` обновлены и включают инструкции по использованию Markdown:

```python
ВАЖНО: Форматируй текст с использованием Markdown:
- Используй ## для основных разделов
- Используй **жирный текст** для важных терминов
- Используй списки для структурирования информации
```

## Стилистика документов

### Word (.docx)

- **Шрифт:** Times New Roman, 12pt (основной текст)
- **Выравнивание:** По ширине (justify)
- **Отступы:**
  - Верхний: 1 дюйм
  - Нижний: 1 дюйм
  - Левый: 1.25 дюйма
  - Правый: 1 дюйм
- **Заголовки:** Встроенные стили Word (Heading 1-6)
- **Списки:** Встроенные стили List Bullet и List Number

### PDF

- **Шрифт:** Times-Roman, 12pt (основной текст)
- **Заголовки:** Times-Bold, 14-16pt
- **Выравнивание:** По ширине (justify)
- **Отступы:** 1 дюйм со всех сторон
- **Межстрочный интервал:** 16pt для основного текста

## Ограничения

1. **Вложенные списки** пока не поддерживаются
2. **Таблицы** не обрабатываются
3. **Ссылки** отображаются как обычный текст
4. **Изображения** не поддерживаются
5. **Блоки кода** (```) не поддерживаются, только инлайн код

## Будущие улучшения

- [ ] Поддержка вложенных списков
- [ ] Обработка таблиц (Markdown tables)
- [ ] Кликабельные ссылки
- [ ] Блоки кода с подсветкой синтаксиса
- [ ] Цитаты (blockquotes)
- [ ] Горизонтальные линии

## Отладка

Для тестирования Markdown форматирования используйте скрипт `test_markdown.py`:

```bash
python test_markdown.py
```

Это создаст тестовый документ со всеми поддерживаемыми элементами форматирования.

## Примеры промптов для Gemini

Все шаблоны документов автоматически используют Markdown:

- **Договор:** Заголовки для разделов, жирный для терминов, нумерованные списки для пунктов
- **Резюме:** Заголовки для разделов, жирный для должностей, маркированные списки для навыков
- **Заявление:** Заголовки для структуры, жирный для важных деталей
- **Отчет:** Иерархия заголовков, списки для перечислений, жирный для выводов
- **Письмо:** Минимальное форматирование, жирный для акцентов

---

**Версия:** 1.0  
**Дата:** 2024-10-30  
**Автор:** Telegram Document Bot Team
